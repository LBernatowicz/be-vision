<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WS Camera + Audio</title>
</head>
<body>

<img id="video" />
<audio id="audio" autoplay></audio>

<script>
const ws = new WebSocket("ws://192.168.100.7:3000/view");

ws.onopen = () => console.log("Connected to server");

ws.onmessage = (event) => {
  const msg = JSON.parse(event.data)
  const bytes = Uint8Array.from(atob(msg.data), c => c.charCodeAt(0))

  if(msg.type === 'video') {
    const blob = new Blob([bytes], { type: 'image/jpeg' });
    const url = URL.createObjectURL(blob);
    const img = document.getElementById("video");
    img.src = url;
    img.onload = () => URL.revokeObjectURL(url);
  }

  if(msg.type === 'audio') {
    const blob = new Blob([bytes], { type: 'audio/wav' });
    const url = URL.createObjectURL(blob);
    const audio = document.getElementById("audio");
    audio.src = url;
    audio.onended = () => URL.revokeObjectURL(url);
  }
}
</script>

</body>
</html>
